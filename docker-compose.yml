version: "3.9"   # Docker Compose file format version (stable & recommended)

services:

  # ============================
  # PROMETHEUS SERVICE
  # ============================
  prometheus:
    image: pavi/prometheus:1.0      # Custom Prometheus image with config baked in
    container_name: prometheus      # Fixed name for easier management & debugging

    volumes:
      # Persistent volume for Prometheus time-series data
      # Ensures metrics are NOT lost if container restarts
      - prometheus_data:/prometheus

    ports:
      # Expose Prometheus Web UI
      - "9090:9090"

    restart: always                 # Auto-restart on crash or server reboot


  # ============================
  # ALERTMANAGER SERVICE
  # ============================
  alertmanager:
    image: pavi/alertmanager:1.0    # Custom Alertmanager image
    container_name: alertmanager

    ports:
      # Expose Alertmanager Web UI
      - "9093:9093"

    restart: always


  # ============================
  # GRAFANA SERVICE
  # ============================
  grafana:
    image: grafana/grafana:10.4.0   # Official Grafana image (version pinned)
    container_name: grafana

    environment:
      # Default Grafana admin credentials
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=admin@

    volumes:
      # Persistent storage for Grafana:
      # dashboards, datasources, users, plugins
      - grafana_data:/var/lib/grafana

    ports:
      # Expose Grafana Web UI
      - "3000:3000"

    restart: always


# ============================
# PERSISTENT VOLUMES
# ============================
volumes:
  prometheus_data:   # Stores Prometheus metrics permanently
  grafana_data:      # Stores Grafana dashboards & configuration
